name: Compilar Civil 3D Plugin

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout del código
      uses: actions/checkout@v4
      
    # 1. PASO NUEVO: Configurar el SDK de .NET para usar el comando 'dotnet restore'
    - name: Configurar .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        # Puedes especificar la versión exacta si es necesario (ej: '6.0.x' según el log)
        dotnet-version: '6.0.x' 

    # 2. PASO NUEVO: Restaurar paquetes NuGet
    # Esto descargará las dependencias y generará el archivo project.assets.json
    - name: Restaurar paquetes NuGet
      run: dotnet restore ExportCivil3DTable/ExportCivil3DTable.csproj

    # 3. Paso de MSBuild: Mantenemos la configuración para la compilación
    - name: Configurar Entorno de MSBuild
      uses: microsoft/setup-msbuild@v1.1
      
    # 4. Compilar proyecto (ahora ya con los paquetes restaurados)
    - name: Compilar proyecto
      run: msbuild ExportCivil3DTable/ExportCivil3DTable.csproj /p:Configuration=Release
      
    # 5. Subir el artefacto compilado (DLL)
    - name: Subir el artefacto compilado (DLL)
      uses: actions/upload-artifact@v4
      with:
        name: ExportCivil3DTable_DLL
        path: ExportCivil3DTable/bin/Release/ExportCivil3DTable.dll
